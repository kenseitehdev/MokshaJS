let components=[];class Batch{constructor(){this.queue=new Set,this.isFlushing=!1,this.flushTimeout=null}add(e){this.queue.add(e),this.scheduleFlush()}scheduleFlush(){this.isFlushing||(this.flushTimeout&&clearTimeout(this.flushTimeout),this.flushTimeout=setTimeout((()=>this.flush()),0))}flush(){0!==this.queue.size&&(this.isFlushing=!0,requestAnimationFrame((()=>{this.queue.forEach((e=>e())),this.queue.clear(),this.isFlushing=!1})))}}class Reactive{constructor(){this.subscribers=new Set}subscribe(e){this.subscribers.add(e)}unsubscribe(e){this.subscribers.delete(e)}notify(){this.subscribers.forEach((e=>e()))}createReactiveState(e){return new Proxy(e,{set(e,t,s){return e[t]=s,this.notify(),!0},get:(e,t)=>e[t]})}}class Store{constructor(e={}){this.reactiveState=new Reactive(this._loadState()||e),this.listeners={},this.batch=new Batch,this.derivedState={}}createNamespace(e,t){this.reactiveState.state[e]?Error.logWarning(`Namespace ${e} already exists.`):(this.reactiveState.state[e]=t,this.listeners[e]=[],this.reactiveState.notify())}subscribe(e,t){if(!this.listeners[e])throw new Error(`Namespace ${e} not found.`);return this.listeners[e].push(t),()=>{this.listeners[e]=this.listeners[e].filter((e=>e!==t))}}derive(e,t){if(!this.reactiveState.state[e])throw new Error(`Namespace ${e} not found.`);this.derivedState[e]=t(this.reactiveState.state[e]),this.subscribe(e,(()=>{this.derivedState[e]=t(this.reactiveState.state[e])}))}getDerived(e){return this.derivedState[e]}setState(e){"object"==typeof e&&null!==e?Object.entries(e).forEach((([e,t])=>{e in this.state?this.state[e]=t:console.warn(`Key "${e}" does not exist in the state`)})):console.error("New values must be an object")}getState(e){return this.reactiveState.state[e]}_notifyListeners(e){const t=this.listeners[e];t&&this.batch.add((()=>{t.forEach((t=>t(this.reactiveState.state[e])))}))}_isEqual(e,t){return JSON.stringify(e)===JSON.stringify(t)}_saveState(){localStorage.setItem("storeState",JSON.stringify(this.reactiveState.state))}_loadState(){const e=localStorage.getItem("storeState");return e?JSON.parse(e):null}}class EventBus{constructor(){this.listeners={}}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach((e=>e(...t)))}off(e,t){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter((e=>e!==t)))}clear(e){this.listeners[e]&&delete this.listeners[e]}}class Error{static logWarning(e){console.warn("Warning:",e)}static logError(e){console.error("Error:",e)}static handler(e){this.logError(e)}}function defineComponent({name:e,template:t,connectedCallback:s,props:r={}}){class n extends HTMLElement{constructor(e,n,i,a){super(),this.props={...r},this.template=document.createElement("template"),this.template.innerHTML=t,this.namespace=n,this.store=e,this.methods=a,this.updateCallback=i,this.userConnectedCallback=s,this.state={updated:!1},this.lifecycle={created:!1,mounted:!1,updated:!1,destroyed:!1}}connectedCallback(){this.lifecycle.created=!0,this.render(),this.userConnectedCallback&&this.userConnectedCallback(),this.addEventListener("click",this.handleClick)}disconnectedCallback(){this.removeEventListener("click",this.handleClick),this.removeEventListener("keyup",this.handleKeyUp),this.unsubscribe&&this.unsubscribe(),this.intervalId&&clearInterval(this.intervalId),this.timeoutId&&clearTimeout(this.timeoutId)}shouldRender(e){for(const t in e)if(this.props[t]!==e[t])return!0;return!1}update(e){this.shouldRender(e)&&(this.props=e,this.render(),this.lifecycle.updated=!0)}destroy(){this.remove(),this.lifecycle.destroyed=!0,this.disconnectedCallback()}static get observedAttributes(){return Object.keys(r)}attributeChangedCallback(e,t,s){t!==s&&(this.updated=!1,this.props[e]=s,this.update(this.props))}render(){components.push({id:components.length,component:this});const e=this.template.content.cloneNode(!0);this.replacePlaceholdersInContent(e),this.innerHTML="",this.appendChild(e),this.lifecycle.mounted=!0}replacePlaceholdersInContent(e){e.querySelectorAll("*").forEach((e=>{e.innerHTML=e.innerHTML.replace(/{{\s*(\w+)\s*}}/g,((e,t)=>this.getAttribute(t)||this.props[t]||""))}))}}return customElements.get(e)||customElements.define(e,n),(t={})=>{const s=document.createElement(e);return Object.keys(t).forEach((e=>s.setAttribute(e,t[e]))),s}}function throttle(e,t){let s,r;return function(...n){const i=this;r?(clearTimeout(s),s=setTimeout((function(){Date.now()-r>=t&&(e.apply(i,n),r=Date.now())}),t-(Date.now()-r))):(e.apply(i,n),r=Date.now())}}function debounce(e,t){let s;return function(...r){const n=this;clearTimeout(s),s=setTimeout((()=>e.apply(n,r)),t)}}class ComponentManager{constructor(){this.elements=[],this.components=[]}}class Selector{constructor(e,t=""){this.selector=e,this.unmountedComponents=[],this.elements=this._getElements(e,t)}_getElements(e,t){let s;return s=e.startsWith("#")?document.getElementById(e.slice(1)):e.startsWith(".")?Array.from(document.getElementsByClassName(e.slice(1))):Array.from(document.getElementsByTagName(e)),(!s||Array.isArray(s)&&0===s.length)&&(s=this.unmountedComponents.filter((t=>e.startsWith("#")?t.id===e.slice(1):e.startsWith(".")?t.classList.contains(e.slice(1)):t.tagName.toLowerCase()===e))),"all"===t?Array.isArray(s)?s:[s]:Array.isArray(s)?s[0]:s}css(e){return this.elements=Array.isArray(this.elements)?this.elements:[this.elements],this.elements.forEach((t=>{t&&Object.assign(t.style,e)})),this}get(e){return this.components.filter((t=>!(t.mounted||e&&t.instance.name!==e))).map((e=>e.instance))}text(e){return this.elements=Array.isArray(this.elements)?this.elements:[this.elements],this.elements.forEach((t=>{t&&(t.innerText=e)})),this}attributes(e,t,s){return"get"===e?this.elements?Array.isArray(this.elements)?this.elements[0]?.getAttribute(t):this.elements.getAttribute(t):null:("set"===e&&(this.elements=Array.isArray(this.elements)?this.elements:[this.elements],this.elements.forEach((e=>{e&&e.setAttribute(t,s)}))),this)}removeChild(e){const t=(e,t)=>{e.contains(t)&&e.removeChild(t)};return this.elements=Array.isArray(this.elements)?this.elements:[this.elements],this.elements.forEach((s=>{s&&(Array.isArray(e)?e.forEach((e=>t(s,e))):e instanceof Node?t(s,e):Error.logError("Invalid child element"))})),this}value(e,t){return"get"===e?this.elements?Array.isArray(this.elements)?this.elements[0]?.value:this.elements.value:null:("set"===e&&(this.elements=Array.isArray(this.elements)?this.elements:[this.elements],this.elements.forEach((e=>{e&&(e.value=t)}))),this)}children(){return this.elements=Array.isArray(this.elements)?this.elements.flatMap((e=>Array.from(e.children))):[this.elements],this}index(){return this.elements.map((e=>{const t=e.parentNode;return t?Array.from(t.children).indexOf(e):-1}))}map(e){return this.elements.map(((t,s)=>e(t,s)))}parent(){return this.elements=Array.from(new Set(this.elements.map((e=>e.parentNode)).filter(Boolean))),this}classList(e,t){return this.elements=Array.isArray(this.elements)?this.elements:[this.elements],this.elements.forEach((s=>{s&&t.split(" ").forEach((t=>{s.classList[e](t)}))})),this}reset(){return this.elements=this._getElements(this.selector,""),this}appendChild(e){return this.elements=Array.isArray(this.elements)?this.elements:[this.elements],this.elements.forEach((t=>{t&&(Array.isArray(e)?e.forEach((e=>t.appendChild(e))):e instanceof Node?t.appendChild(e):Error.logError("Invalid child element"))})),this}on(e,t){return this.elements=Array.isArray(this.elements)?this.elements:[this.elements],this.elements.forEach((s=>{s&&s.addEventListener(e,t)})),this}_getAllElements(){return Array.from(document.body.children)}redraw(){this._getAllElements().forEach((e=>{const t=e.cloneNode(!0);e.parentNode.replaceChild(t,e)}))}}const selector=e=>new Selector(e),store=e=>new Store(e),eventHandler=e=>new EventHandler(e),reactive=e=>new Reactive(e),compManager=e=>new ComponentManager(e),lazyLoad=async e=>{try{const{default:t}=await import(e);appElement.appendChild(new t)}catch(e){Error.logError("Error loading component:",e)}};class VNode{constructor(e,t={},s=[],r=null){this.tag=e,this.props=t,this.children=s,this.key=r,this.el=null}}function propsChanged(e,t){const s=Object.keys(e),r=Object.keys(t);if(s.length!==r.length)return!0;for(const r of s)if(e[r]!==t[r])return!0;return!1}function diff(e,t){if(!e&&!t)return;if(!e||!t||e.tag!==t.tag||e.key!==t.key)return t;propsChanged(e.props,t.props)&&updateProps(e.el,e.props,t.props);const s=e.children||[],r=t.children||[],n=Math.max(s.length,r.length),i=[];for(let e=0;e<n;e++){const t=diff(s[e],r[e]);t&&i.push(t)}return new VNode(t.tag,t.props,i)}function patchChildren(e,t,s){const r=new Map;t.forEach((e=>{e.key&&r.set(e.key,e)})),s.forEach((t=>{if(t.key&&r.has(t.key)){const s=r.get(t.key);if(!diff(s,t)){const r=renderNode(t);e.replaceChild(r,s.el)}r.delete(t.key)}else{const s=renderNode(t);e.appendChild(s)}})),r.forEach((t=>{e.removeChild(t.el)}))}const $={selector:selector,store:store,eventHandler:eventHandler,defineComponent:defineComponent,lazyLoad:lazyLoad,throttle:throttle,debounce:debounce,reactive:reactive,Error:Error,components:components,compManager:compManager,vDOM:null,init(e,t){window.addEventListener("load",(()=>{const s=document.querySelector(e);s?(s.innerHTML="",$.vDOM=new VNode("div",{id:"app"}),$.render(s),t()):Error.logError(`Mount element "${e}" not found.`)}))},render(e){e.innerHTML="",$.renderNode($.vDOM,e)},renderNode(e,t){const s=document.createElement(e.tag);Object.entries(e.props).forEach((([e,t])=>{s[e]=t})),e.children.forEach((e=>{const t="string"==typeof e?document.createTextNode(e):$.renderNode(e,s);s.appendChild(t)})),t.appendChild(s)},updateVNode(e){const t=this.vDOM.el.parentNode;if(t){diff(this.vDOM,e)||patchChildren(t,this.vDOM.children,e.children)}this.vDOM=e},registerComponent(e,t){this.components.add(t)},updateGlobalState(e){this.globalState={...this.globalState,...e},this.updateComponents()},updateComponents(){this.components.forEach((e=>{e.updateCallback&&e.updateCallback(this.globalState)}))}};export{$};
